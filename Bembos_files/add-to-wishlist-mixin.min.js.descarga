define(['jquery','Magento_Customer/js/customer-data','Magento_Wishlist/js/summa-theme/wishlist-items-helper','jquery-ui-modules/widget',],function($,customerData,wishlistAddedHelper){'use strict';return function(target){$.widget('mage.addToWishlist',target,{wishlist:false,processStop:false,isProductInfoMain:false,_create:function(){this._super();if(this.options.wishlist_added_active){this.isProductInfoMain=this.element.hasClass('product-info-main');this.wishlist=customerData.get('wishlist');this.customer=customerData.get('customer');if(this.wishlist().counter){this._setWishlistStatus();}
this.wishlist.subscribe(function(){this._setWishlistStatus();if(this.processStop){$('body').trigger('processStop');}}.bind(this));this.bindAjaxFormSubmit();this.bindSuperAttributeChange();}},bindAjaxFormSubmit:function(){this.element.on('click','[data-action="add-to-wishlist"]',function(event){if(this.customer().firstname){var params,action;params=$(event.currentTarget).data('post');action=params.action;let wishlistItemToRemove=$(event.currentTarget).data('wishlist-item');if(wishlistItemToRemove){let deleteParams=JSON.parse(wishlistItemToRemove.delete_item_params)
action=deleteParams.action;$.extend(params.data,deleteParams.data)}
event.stopPropagation();event.preventDefault();params.data.is_ajax=true;params.data.form_key=$.cookie('form_key');this.processStop=true;$.ajax({url:action,data:params.data,type:'POST',context:this,beforeSend:function(){$('body').trigger('processStart');},success:function(res){customerData.reload(['wishlist','messages']);},error:function(res){customerData.reload(['messages']);$('body').trigger('processStop');this.processStop=false;}});}}.bind(this));},bindFormSubmit:function(){var self=this;this.element.on('click','[data-action="add-to-wishlist"]',function(event){var element,params,form,action;event.stopPropagation();event.preventDefault();element=$('input[type=file]'+self.options.customOptionsInfo);params=$(event.currentTarget).data('post');form=$(element).closest('form');action=params.action;if(params.data.id){$('<input>',{type:'hidden',name:'id',value:params.data.id}).appendTo(form);}
if(params.data.uenc){action+='uenc/'+params.data.uenc;}
$(form).attr('action',action).trigger('submit');});},bindSuperAttributeChange:function(){if(this.element.find('[data-role="swatch-options"]')){this.element.on('change','input[name*=super_attribute]',function(){this._setWishlistStatus();}.bind(this));this.element.find('[data-role="swatch-options"]').not('[data-rendered]').on('swatch.initialized',function(){this._setWishlistStatus();}.bind(this));}},_setWishlistStatus:function(){this.element.find('[data-action="add-to-wishlist"]').removeClass('wishlist-added');this.element.find('[data-action="add-to-wishlist"]').removeAttr('data-wishlist-item').removeData('wishlist-item');let addToWishlistLink,productForm,wishlistItem,attribute,productId,wishlistData=wishlistAddedHelper.getWishlistItemsAdded(this.wishlist());this.element.find('[data-action="add-to-wishlist"]').each(function(i,elem){wishlistItem=false;addToWishlistLink=$(elem);productId=addToWishlistLink.data().post.data.product;if(this.isProductInfoMain){productForm=this.element.find('#product_addtocart_form');}else{productForm=addToWishlistLink.closest('.product-item').find('form[data-role=tocart-form]');}
if(wishlistData&&wishlistData[productId]){wishlistItem=wishlistData[productId].item;if(productForm.length){if(wishlistItem.super_attribute){wishlistItem=null;wishlistData[productId].configurable.forEach(function(configItem){if(!wishlistItem){wishlistItem=configItem;Object.keys(configItem.super_attribute).forEach(function(code){attribute=productForm.find('[name=super_attribute\\['+code+'\\]]');if(!attribute.length||(configItem&&attribute.val()!=configItem.super_attribute[code])){wishlistItem=null;}});}else{if(wishlistItem){return true;}}}.bind(this));}else{productForm.find('input.swatch-input').each(function(i,input){if(input.value){wishlistItem=null;}});}}}
if(wishlistItem){addToWishlistLink.addClass('wishlist-added');addToWishlistLink.attr('data-wishlist-item',JSON.stringify(wishlistItem));}else{}}.bind(this));}});return $.mage.addToWishlist;};});