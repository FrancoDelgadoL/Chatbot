define(['jquery'],function($){'use strict';function removeFromCart(data){if(getCookie(data.cookie_name)){let removedProductsData=JSON.parse(decodeURIComponent(getCookie(data.cookie_name)));delCookie(data.cookie_name);waitForGtmDomThenPush(removedProductsData);}}
function waitForGtmDomThenPush(payload){function hasGtmDom(){return Array.isArray(window.dataLayer)&&window.dataLayer.some(e=>e.event==='gtm.dom');}
function pushPayload(){if(!hasGtmDom())return;clearInterval(intervalId);observer?.disconnect?.();window.dataLayer.push(payload);}
const intervalId=setInterval(()=>{if(hasGtmDom()){pushPayload();}},50);const observer=new MutationObserver(()=>{if(hasGtmDom()){pushPayload();}});observer.observe(document.documentElement,{childList:true,subtree:true});}
function getCookie(name){var cookie=' '+document.cookie,search=' '+name+'=',setStr=null,offset=0,end=0;if(cookie.length>0){offset=cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=cookie.indexOf(';',offset);if(end==-1){end=cookie.length;}
setStr=decodeURI(cookie.substring(offset,end));}}
return setStr;}
function delCookie(name){var date=new Date(0);document.cookie=name+'='+'; path=/; expires='+date.toUTCString();}
return function(data){window.dataLayer?removeFromCart(data):$(document).on('ga:inited',removeFromCart.bind(this,data));$(document).on('ajax:removeFromCart',$.proxy(function(){if(window.dataLayer){removeFromCart({cookie_name:'NGR_REMOVE_ITEM_COOKIE'});}},this));};});