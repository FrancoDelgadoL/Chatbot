define(['jquery','uiComponent','Magento_Customer/js/customer-data','mage/mage','collapsible'],function($,Component,customerData){'use strict';return Component.extend({defaults:{useCollapsibleLogout:false,useLoginModal:false,mobileHideSubmenuDelay:0,authenticationPopupSelector:'.popup-authentication .block-authentication'},collapsibleInitialized:false,collapsibleActionsRegistered:false,accountContainer:null,timeout:null,modalClickAction:null,initialize:function(){this._super();this.customer=customerData.get('customer');this.bindModalAction();this.bindCollapsibleActions();},showModalAction:function(e){if(this.useLoginModal&&window.authenticationPopup&&!this.customer().fullname){e.preventDefault();$(this.authenticationPopupSelector).modal('openModal').trigger('contentUpdated');}},bindModalAction:function(){if(this.useLoginModal&&window.authenticationPopup){this.modalClickAction=this.showModalAction.bind(this)
$('body').on('click','#header-my-account [data-role="trigger"]',this.modalClickAction);}},afterDropdownRender:function(logged){if($('#header-my-account .mage-dropdown-dialog').length){$('#header-my-account .mage-dropdown-dialog .dropdown').dropdownDialog('destroy').remove();}
let dropdownSelector=(logged)?'.dropdown.logged':'.dropdown.not-logged';var $accountContainer=$('#header-my-account .account-container');$accountContainer.addClass('toggle-active').find(dropdownSelector).mage('dropdownDialog',{"appendTo":"#header-my-account .account-container","triggerTarget":"#header-my-account [data-role=trigger]","timeout":"0","closeOnMouseLeave":false,"closeOnEscape":true,"triggerClass":"active","parentClass":"active","bodyClass":"my-account-active","buttons":[]});this.bindCollapsibleActions();this.collapsibleInitialized=true;if(this.useLoginModal&&window.authenticationPopup){$('body').off('click','#header-my-account [data-role="trigger"]',this.modalClickAction);}},bindCollapsibleActions:function(){if(!this.collapsibleActionsRegistered){this.collapsibleActionsRegistered=true;$('body').on('click','[data-role="my-account-trigger"]',function(e){if(this.collapsibleInitialized){e.preventDefault();if($('#header-my-account .account-container').hasClass('active')){setTimeout(function(){$('#header-my-account [data-role="trigger"]').first().click();},this.mobileHideSubmenuDelay);}else{$('#header-my-account [data-role="trigger"]').first().click();}}else{if(this.useLoginModal&&this.showModalAction){e.preventDefault();this.showModalAction();}}}.bind(this));}}});});