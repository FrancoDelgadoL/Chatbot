define(['jquery','uiComponent','Magento_Customer/js/customer-data'],function($,Component,customerData){'use strict';return Component.extend({initialize:function(config){this._super();this.initLoyaltyProgram();},initLoyaltyProgram:function(){let cartData=customerData.get('cart');let userData=customerData.get('customer');const updateLoyaltyPoints=()=>{if(!userData()||!userData().firstname){$('#minicart-loyalty-container').hide();return;}
let loyaltyLevel=parseInt(userData().loyalty_program_level)||1;let subtotal=cartData().subtotalAmount||0;let subtotalValue=Math.floor(parseFloat(subtotal)||0);let loyaltyPoints=Math.floor(subtotalValue*loyaltyLevel);$('#minicart-loyalty-container .points').html(loyaltyPoints);$('#minicart-loyalty-container').show();};const checkAndUpdatePoints=()=>{let interval=setInterval(function(){if($('#minicart-loyalty-container .points').length>0&&$('#minicart-loyalty-container .points').html()!==''){clearInterval(interval);}else{updateLoyaltyPoints();}},500);};$('body').on('click','#product-addtocart-button-toolbar, #product-addtocart-button',function(){checkAndUpdatePoints();});cartData.subscribe(function(){updateLoyaltyPoints();});userData.subscribe(function(){updateLoyaltyPoints();});updateLoyaltyPoints();}});});